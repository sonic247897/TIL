# 3장. 컴퓨터 시스템의 동작 원리

## 1. 컴퓨터 시스템의 동작 원리

> 컴퓨터 시스템 구조 = 컴퓨터 내부장치(CPU, 메모리) + 컴퓨터 외부장치(디스크, 키보드, 마우스, 네트워크 장치 등)

컴퓨터는 외부장치에서 내부장치로 데이터를 읽어와 각종 연산을 수행한 후, 그 결과를 외부장치로 다시 내보내는 방식으로 업무를 처리한다. **=> 입력/출력**

메모리 및 입출력장치 등의 하드웨어 장치에는 `컨트롤러`라는 것이 붙어 있다. 컨트롤러는 각 하드웨어 장치마다 존재하면서 이들을 제어하는 작은 CPU다.

![](images/03_computer_structure.jpg)



## 2. CPU와 I/O 연산

입출력 장치들의 연산(**I/O 연산**)은 `입출력 컨트롤러`가 담당하고, 컴퓨터 내에서 수행되는 연산은 `메인 CPU`가 담당한다. 이때 입출력 장치와 메인 CPU는 동시 수행이 가능하다.

ex) B라는 프로그램이 현재 CPU를 할당받아 프로그램 코드를 수행하고, A라는 프로그램은 하드디스크에서 어떠한 정보를 읽어오는 작업을 수행해야 한다. 이러한 경우 두 가지 일이 다른 곳에서 발생하므로 동시에 수행되는 것이 가능함.

- 로컬버퍼(local buffer)

  : 장치 컨트롤러는 장치로부터 들어오고 나가는 데이터를 임시로 저장하기 위한 **작은 메모리**를 가지고 있다. 이를 로컬버퍼라고 부른다.

  - 디스크나 키보드 등에서 데이터를 읽어오는 경우, 우선 로컬버퍼에 데이터가 임시로 저장된 후 메모리에 전달된다. **이때 장치에서 로컬버퍼로 읽어오는 일은 컨트롤러가 담당한다.**

  - 이때 로컬버퍼로 읽어오는 작업이 다 끝났는지를 메인 CPU가 지속적으로 체크하는 것이 아니라 장치에 있는 컨트롤러가 `인터럽트`를 발생시켜 CPU에 보고하게 된다.
  
- 인터럽트(interrupt)

  : 컨트롤러들이 CPU의 서비스가 필요할 때 이를 통보하는 방법.

  키보드 입력 혹은 요청된 디스크 입출력 작업의 완료 등 CPU에 알려줘야 하는 이벤트가 일어난 경우 컨트롤러가 발생시키는 신호다.

  - CPU는 메모리에서 명령(instruction)을 하나씩 읽어와서 수행하는데, 수행할 때마다 인터럽트가 발생했는지 확인한다.

    (CPU 옆에는 `인터럽트 라인(interrupt line)`이 있어서 그 곳을 통해 신호가 들어온다)

    - 인터럽트가 발생했으면 다음 명령을 수행하기 전에 인터럽트 처리를 함
    - 그렇지 않으면 다음 명령을 계속 수행



## 3. 인터럽트의 일반적 기능

운영체제 **커널**에는 인터럽트가 들어왔을 때 해야할 일이 미리 다 프로그래밍되어 그 코드(`인터럽트 처리루틴`)가 보관되어 있다.

**[인터럽트 처리루틴]**

다양한 인터럽트에 대해 각각 처리해야 할 업무들을 정의한 것

``` java
운영체제의 기능
    1. 하드웨어 및 소프트웨어 자원 관리
    2. 사용자를 위한 편리한 환경 제공
    3. 사용자 프로그램에 필요한 서비스 제공 => 인터럽트 처리루틴
```

1. `프로그램이 요청한 데이터`를 디스크 컨트롤러가 로컬버퍼에서 읽어온 후, 인터럽트를 발생시키면 CPU는 인터럽트가 들어옴을 인지하고 인터럽트 관련 업무를 수행한다.
2. 이 때 수행하는 일은 **디스크의 로컬버퍼에 있는 내용**을 사용자 프로그램의 **메모리**로 전달하고, 해당 프로그램이 CPU를 할당받을 경우 다음 명령을 수행할 수 있음을 표시해두는 일이다.

**[인터럽트]**

CPU의 서비스가 필요한 경우, CPU 옆에 있는 **인터럽트 라인**에 신호를 보내서 인터럽트가 발생했음을 알려주는 방식은 둘 다 동일하다.

1. 하드웨어 인터럽트

   : `컨트롤러` 등 하드웨어 장치가 CPU의 인터럽트 라인을 set

2. 소프트웨어 인터럽트

   : 소프트웨어가 CPU의 인터럽트 라인을 set



운영체제는 인터럽트 코드를 쉽게 찾아가기 위해 **인터럽트 벡터(interrupt vector)**를 가지고 있다.

인터럽트 벡터란 인터럽트 종류마다 번호를 정해서, 번호에 따라 처리해야 할 코드가 위치한 부분을 가리키고 있는 자료구조를 말한다. 실제 처리해야 할 코드는 `인터럽트 처리루틴(interrupt service routine)` 또는 `인터럽트 핸들러(interrupt handler)`라고 불리는 다른 곳에 정의된다.

