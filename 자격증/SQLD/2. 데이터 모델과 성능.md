# Ch01. 데이터 모델링의 이해

## 2. 데이터 모델과 성능

### `성능 데이터 모델링의 개요`

#### 1. 성능 데이터 모델링의 정의

- 데이터베이스에서 기본적으로 **설계**단계에서부터 성능을 고려하여 설계해야 한다.

  물론 개발자가 SQL구문을 잘못 구성하여 성능이 저하되는 경우도 있지만 근본적으로 디자인이 잘못되어 SQL구문을 잘 못 작성하도록 구성될 수밖에 없는 경우도 빈번하게 발생되고 있음을 기억해야 한다.

- 성능이 저하되는 데이터 모델의 경우 크게 세 가지 경우를 고려하여 그 성능을 향상시킬 수 있다. 

  - 데이터 모델 구조에 의해 성능이 저하될 수도 있고 
  - 데이터가 대용량이 됨으로 인해 불가피하게 성능이 저하되어 나타나는 경우도 있다. 
  - 또한 인덱스 특성을 충분히 고려하지 않고 인덱스를 생성함으로 인해 성능이 저하되어 나타나는 경우도 있다.

- 일반적으로 성능이라고 하면 **데이터조회의 성능**을 의미하곤 한다. 그 이유는 데이터입력/수정/삭제는 일시적이고 빈번하지 않고 단건 처리가 많은 반면, 데이터조회의 경우는 **반복적이고 빈번하며 여러 건을 처리하는 경우가 많기 때문**이다. 이러한 특징은 일반적인 트랜잭션의 성격이 조회의 패턴을 가지고 있다는 것이고 업무에 따라서는 입력/수정/삭제의 성능이 중요한 경우도 있다.

- `성능 데이터 모델링`이란 데이터베이스 성능향상을 목적으로 **설계**단계의 데이터 모델링 때부터 정규화, 반정규화, 테이블통합, 테이블분할, 조인구조, PK, FK 등 여러 가지 성능과 관련된 사항이 데이터 모델링에 반영될 수 있도록 하는 것으로 정의할 수 있다.

- **성능 데이터 모델링이 단순히 반정규화만을 의미하지 않음을 주목해야 한다.** 성능데이터 모델링은 정규화를 통해서도 수행할 수 있고 인덱스의 특징을 고려해서 칼럼의 순서도 변형할 수 있다. 또한 대량의 데이터특성에 따라 비록 정규화된 모델이라도 테이블을 수직 또는 수평분할하여 적용하는 방법도 있고 논리적인 테이블을 물리적인 테이블로 전환할 때 데이터 처리의 성격에 따라 변환하는 방법도 성능 데이터 모델링의 범주에 포함될 수 있다.



#### 2. 성능 데이터 모델링 수행시점

- 사전에 할수록 비용이 들지 않는다.
- 많은 프로젝트에서 분석/설계단계 때부터 치밀하게 성능에 대비한 설계를 하지 않고, 성능이 저하된 결과만을 대상으로 **문제발생 시점에 근시안적인 튜닝을 적용**하고 있다.



#### 3. 성능 데이터 모델링 고려사항

- ① 데이터 모델링을 할 때 **정규화**를 정확하게 수행한다.
  ② 데이터베이스 **용량산정**을 수행한다.
  ③ 데이터베이스에 발생되는 **트랜잭션의 유형을 파악**한다.
  ④ 용량과 트랜잭션의 유형에 따라 **반정규화**를 수행한다.
  ⑤ **이력모델의 조정, PK/FK조정, 슈퍼타입/서브타입 조정** 등을 수행한다.
  ⑥ 성능관점에서 데이터 모델을 검증한다.

- 데이터 모델링을 할 때 기본적으로 정규화를 완벽하게 수행해야 한다. 정규화된 모델이 **데이터를 주요 관심사별로 분산시키는 효과**가 있기 때문에 그 자체로 성능을 향상시키는 효과가 있다. 
- 정규화가 완성된 후, 각각의 엔터티에 어느 정도 <u>트랜잭션</u>이 들어오는지 살펴볼 필요가 있다. 이 때 가장 좋은 방법이 엔터티에 대한 <u>용량산정</u>을 하는 것이다. **각각의 엔터티(테이블)에 대한 용량산정을 수행하면 어떤 엔터티(테이블)에 데이터가 집중되는지 파악할 수 있다.**
- 또한 데이터 모델에 발생되는 트랜잭션의 유형을 파악할 필요가 있다. CRUD 매트릭스를 보고 파악하거나, 객체지향 모델링을 적용한다면 시퀀스 다이어그램을 보면 된다. 또한 이벤트(입력, 수정, 삭제, 조회)에 따라 테이블에 데이터가 어떻게 처리되는지를 유추할 수 있다. 트랜잭션의 유형을 파악하게 되면 SQL문장의 **조인관계 테이블에서 데이터조회의 칼럼들을 파악**할 수 있게 된다.
- 반정규화는 테이블, 속성, 관계에 대해 포괄적인 반정규화의 방법을 적용해야 한다. 
- 또한 반드시 **PK/FK를 성능이 우수한 순서대로 칼럼의 순서를 조정**해야 한다.



### `정규화와 성능`

#### 1. 정규화를 통한 성능 향상 전략

- 정규화를 하는 것은 데이터에 대한 **중복성을 제거**하여 주고 **데이터가 관심사별로 처리**되는 경우가 많기 때문에 성능이 향상되는 특징을 가지고 있다. 
- 물론 엔터티가 계속 발생되므로 SQL문장에서 **조인이 많이 발생**하여 이로 인한 성능저하가 나타나는 경우도 있지만 이런 부분은 사례별로 유의하여 `반정규화`를 적용하는 전략이 필요하다.
- 정규화를 수행하면 항상 조회 성능이 저하되어 나타날까?
  데이터베이스에서 데이터를 처리할 때 성능이라고 하면 <u>조회</u> 성능과 <u>입력/수정/삭제</u> 성능의 두 부류로 구분된다. 이 두 가지 성능이 모두 우수하면 좋겠지만 데이터 모델을 구성하는 방식에 따라 두 성능이 **Trade-Off** 되어 나타나는 경우가 많이 있다.
- 정규화를 수행한다는 것은 데이터를 결정하는 결정자에 의해 함수적 종속을 가지고 있는 일반속성을 의존자로 하여 입력/수정/삭제 이상을 제거하는 것이다. 데이터의 중복속성을 제거하고 결정자에 의해 동일한 의미의 일반속성이 하나의 테이블로 집약되므로 한 테이블의 데이터 용량이 최소화되는 효과가 있다. 따라서 정규화된 테이블은 데이터를 처리할 때 속도가 빨라질 수도 있고 느려질 수도 있는 특성이 있다.